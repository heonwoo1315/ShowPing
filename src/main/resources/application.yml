spring:
  config:
    import:
      # AWS Secrets Manager에서 시크릿을 불러옴
      - aws-secretsmanager:/showping/prod/credentials

  cloud:
    aws:
      region:
        static: ap-northeast-2
      credentials:
        # GitHub Secrets에서 주입되는 환경변수를 사용
        access-key: ${AWS_ACCESS_KEY_ID}
        secret-key: ${AWS_SECRET_ACCESS_KEY}


  application:
    name: show-ping-live

  web:
    encoding:
      charset: UTF-8
      enabled: true
      force: true
    resources:
      cache:
        cachecontrol:
          no-store: true

  mvc:
    pathmatch:
      matching-strategy: ant_path_matcher

  # DB 설정
  datasource: # RDS_HOSTNAME은 나중에 RDS 생성하면 값을 엔드포인트로 설정 지금은 localhost임
    url: jdbc:mysql://${RDS_HOSTNAME}:${RDS_PORT}/${RDS_DB_NAME}?serverTimezone=Asia/Seoul&characterEncoding=UTF-8&useSSL=false&allowPublicKeyRetrieval=true
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      pool-name: WinnerHikariPool
      minimum-idle: 5
      maximum-pool-size: 10
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  h2:
    console:
      enabled: false

  main:
    allow-bean-definition-overriding: true

  # Kafka 설정
  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS}
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
    consumer:
      group-id: chat-consumer-group
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: "*"
        spring.json.use.type.headers: false
        spring.json.add.type.headers: false
        spring.json.value.default.type: com.ssginc.showpingrefactoring.domain.chat.dto.object.ChatDto

  # NoSQL 및 Cache 설정
  data:
    mongodb:
      host: ${MONGO_HOST}
      port: ${MONGO_PORT}
      database: ${MONGO_DB_NAME:showping}
    redis:
      host: ${REDIS_HOST}
      port: ${REDIS_PORT}
      timeout: 60000

  # JPA 설정
  jpa:
    hibernate:
      ddl-auto: ${JPA_DDL_AUTO:update}
      naming:
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
        implicit-strategy: org.hibernate.boot.model.naming.ImplicitNamingStrategyJpaCompliantImpl
      properties:
        hibernate:
          use_sql_comments: true
          format_sql: true
          generate_statistics: true
          dialect: org.hibernate.dialect.MySQLDialect
    defer-datasource-initialization: true
    show-sql: true

  sql:
    init:
      mode: ${SQL_INIT_MODE:always}

  # 메일 설정
  mail:
    host: smtp.gmail.com
    port: 587
    default-encoding: UTF-8
    protocol: smtp
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
          ssl:
            trust: smtp.gmail.com

# Embedded MongoDB (테스트용)
de:
  flapdoodle:
    mongodb:
      embedded:
        version: 5.0.5

# 모니터링 및 서버 설정
management:
  endpoint:
    health:
      show-details: always
  endpoints:
    jmx:
      exposure:
        include: '*'

kurento:
  url: ${KMS_URL:ws://127.0.0.1:8888/kurento}

server:
  port: ${SERVER_PORT}
  forward-headers-strategy: native

  servlet:
    session:
      cookie:
        secure: true
        http-only: true
        same-site: lax

# 파일 경로 설정 (EC2 환경에 맞춰 환경변수화 추천)
upload:
  path: ${UPLOAD_PATH}
download:
  path: ${DOWNLOAD_PATH}

# 로그 설정
logging:
  level:
    root: INFO
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql: TRACE
    org.hibernate.orm.jdbc.bind: TRACE
  file:
    name: logs/app.log
    path: logs
  pattern:
    console: '%logger{36} - %msg%n'
    file: '%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n'

# 보안 및 인증
jwt:
  access:
    expiration: 3600000
  refresh:
    expiration: 86400000

# NCP 설정
ncp:
  storage:
    region: kr-standard
    endpoint: https://kr.object.ncloudstorage.com/
    bucket-name: show-ping
  clova-speech:
    path: video

# PortOne 결제 설정
portone:
  api-url: https://api.portone.io

# WebAuthn 및 MFA 설정
webauthn:
  rp:
    id: showping-live.com
    name: "ShowPing Live"
  origin: https://showping-live.com

mfa:
  allowSelfInvite: true
  issuer: ShowPing
  periodSeconds: 30
  allowedStepSkew: 1
  inviteTtlSeconds: 600
  webauthnChallengeTtlSeconds: 120
  mfaMaxAgeSeconds: 900
  rateLimitPerMinute: 5

# Redis 추가 설정
redis:
  prefix: "sp:mfa:"
  ttl:
    rtMetaSeconds: 604800
    halfAuthSeconds: 900